---
title: "USA Rezessionswahrscheinlichkeit"
author: "Philipp Hauber"
date: "2 12 2019"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=8, fig.height=6, #fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r}
# clear workspace
rm(list = ls())

# turn off scientific notation
options(scipen = 999)

# working directory
#setwd("C:/Users/Philipp/Documents/GitHub/US-term-spread-rec-prob")
setwd("C:/Users/Hauber/Documents/GitHub/US-term-spread-rec-prob")

# libraries
library(fredr)
library(purrr)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)

# set API key for FRED
fredr_set_key("84efd638e2db29ef758e0d8e081a4c05")
```


# Motivation

# Literatur

# Daten

```{r}
# load yield curve data, recession indicator and Fed Board term premium from FRED #################
var_mnemonic <- c("USREC", "GS10", "TB3MS", "THREEFYTP10")
var_names <- c("nber_rec", "i10y", "i3m", "tp_board")
data_fred <- data.frame()
for (i in 1 : length(varnames)) {
    tmp <- fredr(series_id = var_mnemonic[i], 
                                 observation_start = as.Date("1950-01-01"),
                                 frequency = "q", 
                                 aggregation_method = "avg"
                 )
    
    tmp[, "series_id"] <- var_names[i]
    
    data_fred <- rbind(data_fred, tmp)
}

ggplot(filter(data_fred_raw, series_id == "nber_rec"), aes(x = date, y = value, group = series_id))+
        geom_line()



# load term spread data from NY Fed ################
data_nyfed_raw <- read.table("ACMTermPremium.csv", 
                   header = TRUE, 
                   sep = ";", 
                   blank.lines.skip = FALSE)

data_nyfed_raw$DATE <- dmy(data_nyfed_raw$DATE)

# select term premium on 10 year bond
data_nyfed <- data_nyfed_raw %>% rename(date = DATE, tp_d = ACMTP10) %>%
                            select(date, tp_d) %>% 
                            mutate(yy = year(date), mm = month(date)) %>%
                            group_by(yy, mm) %>%
                            summarise(tp_ny = round(mean(tp_d),2)) %>%
                            ungroup() %>% 
                            mutate(date = make_date(year = yy, month = mm)) %>%
                            select(-yy, -mm) %>%
                            select(date, tp_ny)

# load term spread data from SF Fed ################
data_sffed_raw <- read.table("FRBSF_Term_Model_Data.csv", 
                   header = TRUE, 
                   sep = ";", 
                   blank.lines.skip = FALSE)

data_sffed_raw$DATE <- dmy(data_sffed_raw$DATE)





# merge two datasets and create term-premium adjusted spread ########
data <- merge(data_fred, data_nyfed, by = "date") %>% mutate(i10y_tp_ny = i10y - tp_ny,
                                                             spr_tp_ny = i10y - tp_ny - i3m)
 
 # convert to quarterly frequency ####################
 dataQ <- data %>% gather(variable, value, -date) %>% 
                  mutate(yy = year(date), qq = ceiling(month(date)/3)) %>%
                  group_by(yy, qq, variable) %>%
                  summarise(tmp = mean(value)) %>%
                  spread(variable, tmp) %>%
                  ungroup() %>% 
                  mutate(date = make_date(year = yy, month = 3*qq),
                         nber_rec = round(nber_rec,0)) %>%
                  select(-yy, -qq) %>%
                  select(date, everything()) 
```

## Zinsstrukturkurve

## NBER-Rezessionsindikator

## Laufzeitprämien

# Schätzung

# Evaluierung


